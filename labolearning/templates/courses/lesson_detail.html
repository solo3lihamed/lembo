{% extends 'base.html' %}

{% block content %}
<div style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center;">
    <a href="{% url 'course_detail' course.id %}"
        style="text-decoration: none; font-weight: 900; color: var(--secondary-color); font-size: 1.1rem; background: white; padding: 0.5rem 1rem; border: 2px solid black; box-shadow: 4px 4px 0px black;">‚¨ÖÔ∏è
        Back to Course</a>

    <div style="display: flex; gap: 1rem;">
        <span class="brutal-card"
            style="padding: 0.5rem 1rem; background: var(--accent-color); font-weight: 900;">Lesson {{ lesson.order }}
            of {{ all_lessons.count }}</span>
    </div>
</div>

<div class="lesson-layout" style="display: grid; grid-template-columns: 1fr; gap: 2rem;">
    <!-- Video Section -->
    {% if lesson.video_file %}
    <div class="video-container" style="width: 100%;">
        <div class="brutal-card" style="padding: 1rem; background: #000; position: relative; width: 100%;">
            <div
                style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border: 4px solid white;">
                <video controls style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                    <source src="{{ lesson.video_file.url }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            <div style="margin-top: 1rem; color: white;">
                <h2 style="margin: 0; color: var(--primary-color);">Now Playing: {{ lesson.title }} üé•</h2>
            </div>
        </div>
    </div>
    {% endif %}

    <div style="display: grid; grid-template-columns: 2.5fr 1fr; gap: 2rem; align-items: start;"
        class="main-content-grid">
        <!-- Content Section -->
        <div class="brutal-card" style="background: white; padding: 2rem;">
            <h1 style="margin-top: 0; font-size: 2.5rem; text-transform: uppercase; line-height: 1;">{{ lesson.title }}
            </h1>
            <hr style="border: 2px solid black; margin: 2rem 0;">
            <div style="font-size: 1.2rem; line-height: 1.8; color: #333;">
                {{ lesson.content|linebreaks }}
            </div>

            <!-- Navigation Buttons -->
            <div style="margin-top: 4rem; display: flex; justify-content: space-between; gap: 1rem; flex-wrap: wrap;">
                <button class="brutal-btn secondary" style="flex: 1; min-width: 200px;">‚¨ÖÔ∏è Previous Session</button>
                <button class="brutal-btn accent" style="flex: 1; min-width: 200px;">Mark as Done & Next ‚û°Ô∏è</button>
            </div>
        </div>

        <!-- Sidebar / Lesson List -->
        <div class="brutal-card" style="background: var(--primary-color); padding: 1.5rem;">
            <h3
                style="margin-top: 0; background: black; color: white; display: inline-block; padding: 0.3rem 1rem; transform: rotate(-2deg);">
                COURSE OUTLINE üìã</h3>
            <div style="margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.8rem;">
                {% for l in all_lessons %}
                <a href="{% url 'lesson_detail' l.id %}" style="text-decoration: none; color: inherit;">
                    <div class="brutal-card"
                        style="padding: 0.8rem; background: {% if l.id == lesson.id %}white{% else %}rgba(255,255,255,0.5){% endif %}; border-width: 2px; {% if l.id == lesson.id %}box-shadow: 4px 4px 0px black; transform: translate(-2px, -2px);{% endif %}">
                        <span style="font-weight: 900;">#{{ l.order }}</span> {{ l.title }}
                        {% if l.id == lesson.id %}<span style="float: right;">üëâ</span>{% endif %}
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
    @media (max-width: 1024px) {
        .main-content-grid {
            grid-template-columns: 1fr !important;
        }
    }

    .lesson-layout video:focus {
        outline: none;
    }
</style>
{% endblock %}